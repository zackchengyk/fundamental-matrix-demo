var Oe=Object.defineProperty,Be=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var Pe=(t,n,a)=>n in t?Oe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,oe=(t,n)=>{for(var a in n||(n={}))Xe.call(n,a)&&Pe(t,a,n[a]);if(Ne)for(var a of Ne(n))Ke.call(n,a)&&Pe(t,a,n[a]);return t},re=(t,n)=>Be(t,We(n));import{M as Q,j as fe,R as K,a as se,V as g,Q as $e,S as Ge,b as Ye,I as _e,c as Ue,d as Ze,P as Qe,C as Je,L as et,B as tt,e as nt,W as it,O as at,A as ot,f as ye,G as rt,r as h,g as Me,h as st}from"./vendor.bdc920a1.js";const ct=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}};ct();var $;(function(t){t[t.nothing=0]="nothing",t[t.setPointToOrigin=1]="setPointToOrigin"})($||($={}));var l;(function(t){t[t.nothing=0]="nothing",t[t.setLookPositionToOrigin=1]="setLookPositionToOrigin",t[t.setRotationToIdentity=2]="setRotationToIdentity",t[t.resetTransforms=3]="resetTransforms",t[t.useStandardViewX=4]="useStandardViewX",t[t.useStandardViewY=5]="useStandardViewY",t[t.useStandardViewZ=6]="useStandardViewZ",t[t.setRotationToMatchC1=7]="setRotationToMatchC1",t[t.setRotationToMatchC2=8]="setRotationToMatchC2",t[t.setPositionToMatchC1=9]="setPositionToMatchC1",t[t.setPositionToMatchC2=10]="setPositionToMatchC2"})(l||(l={}));const lt=5,dt=/^(-?)0(\.)/;function E(t){if(typeof t=="string")return t;if(Math.abs(t)<1e-4)return"0";const a=(Math.round(t*1e3)/1e3).toString().replace(dt,"$1$2"),o=Math.max(a.indexOf(".")+3,lt);return a.length>o?a.slice(0,o-1)+"\u2026":a.slice(0,o)}function ht(t){return new Q().fromArray([0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0])}function Te(t){const n=t.elements;return new Q().fromArray([n[0],n[1],n[2],n[4],n[5],n[6],n[8],n[9],-n[10],0,0,0])}function Re(t,n){return t.length===n.length&&t.every((a,o)=>a===n[o])}function ut(t,n,a){return Math.abs(t.x-n.x)<a&&Math.abs(t.y-n.y)<a&&Math.abs(t.z-n.z)<a&&Math.abs(t.w-n.w)<a}const e=fe.exports.jsx,i=fe.exports.jsxs,Ae=fe.exports.Fragment;function ce({label:t,array:n,className:a,style:o}){return i("div",{className:"matrix "+a,children:[e("div",{className:"matrix-label",children:t}),e("div",{className:"matrix-elements",style:o,children:n.map((s,r)=>e("span",{className:"limit-dp",children:E(s)},r))})]})}function pt({label:t,matrix:n,className:a}){return e(ce,{label:t,array:n.elements,className:a,style:{gridTemplate:"repeat(4, 1fr) / repeat(4, auto)"}})}function mt(t,n){return t.label===n.label&&t.matrix.equals(n.matrix)}const G=K.memo(pt,mt);function xt({label:t,vector:n,className:a}){return e(ce,{label:t,array:n.toArray(),className:a,style:{gridTemplate:"repeat(4, 1fr) / auto"}})}function bt(t,n){return t.label===n.label&&t.vector.equals(n.vector)}const B=K.memo(xt,bt);function ft({label:t,matrix:n,className:a}){const o=n.elements,s=o.length===16?[o[0],o[1],o[2],o[4],o[5],o[6],o[8],o[9],o[10]]:o;return e(ce,{label:t,array:s,className:a,style:{gridTemplate:"repeat(3, 1fr) / repeat(3, auto)"}})}function yt(t,n){return t.label===n.label&&Re(t.matrix.elements,n.matrix.elements)}const w=K.memo(ft,yt);function gt({label:t,vector:n,className:a}){const o=n.toArray(),s=o.length===4?[o[0],o[1],o[2]]:o;return e(ce,{label:t,array:s,className:a,style:{gridTemplate:"repeat(3, 1fr) / auto"}})}function wt(t,n){return t.label===n.label&&Re(t.vector.toArray(),n.vector.toArray())}const P=K.memo(gt,wt);function vt({label:t,matrix:n,className:a}){const o=n.elements,s=[o[0],o[1],o[2],o[4],o[5],o[6],o[8],o[9],o[10],o[12],o[13],o[14]];return e(ce,{label:t,array:s,className:a,style:{gridTemplate:"repeat(3, 1fr) / repeat(4, auto)"}})}function kt(t,n){return t.label===n.label&&t.matrix.equals(n.matrix)}const S=K.memo(vt,kt);var H;(function(t){t[t.anything=0]="anything",t[t.maintainDirection=1]="maintainDirection",t[t.exactToLookAt=2]="exactToLookAt",t[t.slerpToLookAt=3]="slerpToLookAt"})(H||(H={}));const Ce=12,le=new g,Fe=new se,ge=new $e;function Nt(t){we(t,t.camera.position),me(t,t.orbitControls.target)}function we(t,n,a){t.lookDirUpdateMode=a==null?0:a,t.targetPosition.copy(n)}function me(t,n){t.orbitControls.target.copy(n),t.targetLookPosition.copy(n)}function Pt(t,n){for(const a of n.cameraData){const o=a.container.clientWidth,s=a.container.clientHeight;a.camera.aspect=o/s,a.camera.updateProjectionMatrix(),a.renderer.setSize(o,s)}}function Mt(t,n){const a=(t-n.prevTime)/1e3;n.prevTime=t;const o=n.pointPosition;n.isMoving?(o.y=2+Math.sin(t*.0015)*2,n.fixedPointPosition=null):n.fixedPointPosition!=null&&o.copy(n.fixedPointPosition);for(let s=0;s<3;s++){const r=n.cameraData[s],d=r.camera,M=r.line,x=r.orbitControls;let L=!1,c=!1;const u=r.targetPosition;le.subVectors(d.position,u);const k=le.length();if(k>1e-4){L=!0;const N=Ce*a;d.position.lerp(u,N),d.updateProjectionMatrix(),(r.lookDirUpdateMode===0||r.lookDirUpdateMode===2)&&(r.lookDirUpdateMode=k>.5?2:3)}else r.lookDirUpdateMode=3;switch(s===1&&console.log(r.lookDirUpdateMode),r.lookDirUpdateMode){case 1:break;case 2:{x.target.copy(r.targetLookPosition),d.lookAt(r.targetLookPosition);break}case 3:{if(le.copy(r.targetLookPosition).add(d.position).sub(r.targetPosition),Fe.lookAt(d.position,le,d.up),ge.setFromRotationMatrix(Fe),!ut(d.quaternion,ge,1e-4)){c=!0;const N=Ce*a;r.orbitControls.target.copy(le),d.quaternion.slerp(ge,N),d.updateProjectionMatrix()}break}}!L&&!c&&x.update();const b=M.geometry.attributes.position.array,C=o.clone().sub(d.position),v=d.position.clone().add(C.clone().multiplyScalar(-1e3)),f=d.position.clone().add(C.clone().multiplyScalar(1e3));b[0]=v.x,b[1]=v.y,b[2]=v.z,b[3]=f.x,b[4]=f.y,b[5]=f.z,M.geometry.attributes.position.needsUpdate=!0}}const de=new Ge;de.showPanel(0);document.body.appendChild(de.dom);de.dom.style.zIndex="100000000000000";function De(t,n,a){n.nextFrameReq=requestAnimationFrame(o=>De(o,n)),de.begin(),Pt(t,n),Mt(t,n),Tt(n),de.end()}function Tt(t){Rt(t),At(t)}function Rt(t){t.cameraData.forEach(({renderer:n,camera:a})=>{n.render(t.scene,a)})}function At(t){t.updateGUIFunction(t)}const Ct=6010245,Ft=33511;function Dt(t){const n=new Ye,a=new _e(.25),o=new Ue({color:15257272}),s=new Ze(a,o);s.layers.enableAll(),n.add(s);const r=[];for(let c=0;c<t.length;c++){const u=t[c].container,k=t[c].canvas,b=u.clientWidth,C=u.clientHeight,v=b/C,f=new Qe(40,v,1e-4,1e4);f.position.fromArray(Se(c)),f.layers.set(c);const N=new Je(f);N.layers.disableAll(),N.layers.enable(2),c!==2&&n.add(N);const q=new et({color:c?Ct:Ft}),j=[f.position,s.position],F=new tt().setFromPoints(j),T=new nt(F,q);T.frustumCulled=!1,T.layers.enableAll(),T.layers.disable(c),T.visible=!1,c!==2&&n.add(T);const p=new it({canvas:k,alpha:!0});p.setPixelRatio(window.devicePixelRatio),p.setClearColor(16777215,0),p.setSize(b,C);const V=new at(f,u),D={container:u,canvas:k,camera:f,renderer:p,cameraHelper:N,line:T,orbitControls:V,targetPosition:new g().copy(f.position),targetLookPosition:new g,lookDirUpdateMode:H.slerpToLookAt,extrinsicMatrix:f.matrixWorldInverse,intrinsicMatrix:f.projectionMatrix};V.addEventListener("change",()=>Nt(D)),r.push(D)}const d=new ot(10);d.setColors(new ye(16711680),new ye(65280),new ye(255)),d.layers.enableAll(),n.add(d);const M=new rt(5,5,16711680,8680812);M.layers.enableAll(),n.add(M);let x="dummy";return x={isMoving:!1,modifierFunctions:{enableMovement(c){x.isMoving=c},setPointPosition(c){c!=null&&(x.fixedPointPosition=c.clone())},showFrustum(c,u){u?r[c].cameraHelper.layers.enableAll():(r[c].cameraHelper.layers.disableAll(),r[c].cameraHelper.layers.enable(2))},showEpipolarLines(c){r.forEach(({line:u})=>u.visible=c)},setPosition(c,u,k){we(r[c],u,k)},setLookPosition(c,u){me(r[c],u)},resetTransforms(c){we(r[c],new g().fromArray(Se(c)),H.slerpToLookAt),me(r[c],new g)},setRotationToIdentity:c=>{const u=r[c],k=u.camera,b=u.orbitControls.getDistance(),C=new g(k.position.x,k.position.y,k.position.z-b);me(u,C)}},scene:n,pointPosition:s.position,fixedPointPosition:null,updateGUIFunction:c=>{},nextFrameReq:0,prevTime:0,cameraData:r},x}function Se(t){switch(t){case 0:return[5,5,20];case 1:return[30,20,10];case 2:return[30,60,30];default:return[0,0,0]}}function St(t,n,a,o,s,r){const d=Dt([{container:t,canvas:n},{container:a,canvas:o},{container:s,canvas:r}]);return d.nextFrameReq=requestAnimationFrame(M=>De(M,d)),d}function J({x:t,y:n,className:a}){return e("div",{className:"target "+a,style:{transform:`translate(${-t*50}%, ${n*50}%) scale(0.04)`}})}function Le(t,n,a){switch(a){case l.setLookPositionToOrigin:{t.modifierFunctions.setLookPosition(n,new g);break}case l.setRotationToIdentity:{t.modifierFunctions.setRotationToIdentity(n);break}case l.resetTransforms:{t.modifierFunctions.resetTransforms(n);break}case l.useStandardViewX:{t.modifierFunctions.setPosition(n,new g(10,0,0),H.exactToLookAt),t.modifierFunctions.setLookPosition(n,new g);break}case l.useStandardViewY:{t.modifierFunctions.setPosition(n,new g(0,10,0),H.exactToLookAt),t.modifierFunctions.setLookPosition(n,new g);break}case l.useStandardViewZ:{t.modifierFunctions.setPosition(n,new g(0,0,10),H.exactToLookAt),t.modifierFunctions.setLookPosition(n,new g);break}case l.setRotationToMatchC1:break;case l.setRotationToMatchC2:break;case l.setPositionToMatchC1:{t.modifierFunctions.setPosition(n,t.cameraData[0].camera.position,H.maintainDirection);const o=t.cameraData[n].targetLookPosition.clone().add(t.cameraData[0].camera.position).sub(t.cameraData[n].camera.position);t.modifierFunctions.setLookPosition(n,o);break}case l.setPositionToMatchC2:{t.modifierFunctions.setPosition(n,t.cameraData[1].camera.position,H.maintainDirection);const o=t.cameraData[n].targetLookPosition.clone().add(t.cameraData[1].camera.position).sub(t.cameraData[n].camera.position);t.modifierFunctions.setLookPosition(n,o);break}}}function Lt({x:t,xp:n,lFunction:a,lpFunction:o,setX:s,isMoving:r,setK:d,setM:M,setC1Pos:x,showC1Display:L,setKp:c,setMp:u,setC2Pos:k,showC2Display:b,showC3Display:C,otherThingsToShow:v,sceneCommand:f,setSceneCommand:N,c1Command:q,setC1Command:j,c2Command:F,setC2Command:T}){const p=h.exports.useRef(),V=h.exports.useRef(),D=h.exports.useRef(),Y=h.exports.useRef(),_=h.exports.useRef(),ee=h.exports.useRef(),te=h.exports.useRef();h.exports.useEffect(()=>{if(!(f===$.nothing||p.current==null)){switch(f){case $.setPointToOrigin:p.current.modifierFunctions.setPointPosition(new g)}N($.nothing)}},[f]),h.exports.useEffect(()=>{q===l.nothing||p.current==null||(Le(p.current,0,q),j(l.nothing))},[q]),h.exports.useEffect(()=>{F===l.nothing||p.current==null||(Le(p.current,1,F),T(l.nothing))},[F]),h.exports.useEffect(()=>{p.current!=null&&p.current.modifierFunctions.enableMovement(r)},[r]),h.exports.useEffect(()=>{p.current!=null&&p.current.modifierFunctions.showFrustum(0,v.c1Frustum)},[v.c1Frustum]),h.exports.useEffect(()=>{p.current!=null&&p.current.modifierFunctions.showFrustum(1,v.c2Frustum)},[v.c2Frustum]),h.exports.useEffect(()=>{p.current!=null&&p.current.modifierFunctions.showEpipolarLines(v.epipolarLines)},[v.epipolarLines]);function U(R){const W=new Me(R.pointPosition.x,R.pointPosition.y,R.pointPosition.z,1);s(m=>W.equals(m)?m:W);const he=Te(R.cameraData[0].intrinsicMatrix.clone()),X=R.cameraData[0].extrinsicMatrix.clone(),ne=R.cameraData[0].camera.position.clone();d(m=>he.equals(m)?m:he),M(m=>X.equals(m)?m:X),x(m=>ne.equals(m)?m:ne);const ie=Te(R.cameraData[1].intrinsicMatrix.clone()),Z=R.cameraData[1].extrinsicMatrix.clone(),xe=R.cameraData[0].camera.position.clone();c(m=>ie.equals(m)?m:ie),u(m=>Z.equals(m)?m:Z),k(m=>ne.equals(m)?m:xe)}h.exports.useEffect(()=>{p.current=St(V.current,D.current,Y.current,_.current,ee.current,te.current),p.current.updateGUIFunction=U,U(p.current)},[]);const O={opacity:0,pointerEvents:"none"};return i("div",{id:"demo-window",children:[e("div",{children:i("div",{className:"container",ref:V,style:L?{}:O,children:[e("canvas",{className:"canvas",ref:D}),v.c1PointPrediction?e(J,{x:t.x,y:t.y,className:"blue"}):null,v.epipolarLinePredictions?i(Ae,{children:[e(J,{x:-1,y:a(-1),className:"green"}),e(J,{x:1,y:a(1),className:"green"})]}):null,e("div",{className:"container-label",children:"Camera 1 (c1)"})]})}),e("div",{children:i("div",{className:"container",ref:Y,style:b?{}:O,children:[e("canvas",{className:"canvas",ref:_}),v.c2PointPrediction?e(J,{x:n.x,y:n.y,className:"green"}):null,v.epipolarLinePredictions?i(Ae,{children:[e(J,{x:-1,y:o(-1),className:"blue"}),e(J,{x:1,y:o(1),className:"blue"})]}):null,e("div",{className:"container-label",children:"Camera 2 (c2)"})]})}),e("div",{children:i("div",{className:"container",ref:ee,style:C?{}:O,children:[e("canvas",{className:"canvas",ref:te}),e("div",{className:"container-label",children:"Witness Camera"})]})})]})}const ve=t=>{const n=h.exports.useRef(null),[a,o]=h.exports.useState(!1),s=r=>{var x;const[d]=r,M=((x=d.rootBounds)==null?void 0:x.top)||0;o(d.isIntersecting||d.boundingClientRect.top-M<0)};return h.exports.useEffect(()=>{const r=new IntersectionObserver(s,t);return n.current&&r.observe(n.current),()=>{n.current&&r.unobserve(n.current)}},[n,t]),[n,a]},A=K.forwardRef(({initialCollapse:t=!1,children:n},a)=>{const[o,s]=h.exports.useState(t);return e("div",{className:"matrix-equation collapsible "+(o?"collapsed":""),onClick:()=>s(r=>!r),ref:a,children:n})}),qt=new se().fromArray(["a","e","i",0,"b","f","j",0,"c","g","k",0,"d","h","l",0]),It=new Q().fromArray(["fx",0,0,"s","fy",0,"u0","v0",1]),zt=new se().fromArray(["r11","r21","r31",0,"r12","r22","r32",0,"r13","r23","r33",0,"tx","ty","tz",0]);function Et(){const[t,n]=h.exports.useState(new Me),[a,o]=h.exports.useState(new Q),[s,r]=h.exports.useState(new se),[d,M]=h.exports.useState(new g),x=t.clone().applyMatrix4(s),L=new g(x.x,x.y,x.z).applyMatrix3(a),c=L.clone().divideScalar(L.z),[u,k]=h.exports.useState(new Q),[b,C]=h.exports.useState(new se),[v,f]=h.exports.useState(new g),N=t.clone().applyMatrix4(b),q=new g(N.x,N.y,N.z).applyMatrix3(u),j=q.clone().divideScalar(q.z),F=s.clone().invert(),T=b.clone().multiply(F),p=new Q().setFromMatrix4(T),V=new g().setFromMatrixColumn(T,3),D=p.clone().transpose(),Y=V.clone().multiplyScalar(-1).applyMatrix3(D),_=ht(Y),ee=a.clone().invert().transpose(),te=u.clone().invert(),U=_.clone().multiply(D),O=ee.clone().multiply(U).multiply(te),R=O.clone().transpose(),W=j.clone().applyMatrix3(O),he=y=>(-W.z-W.x*y)/W.y,X=c.clone().applyMatrix3(R),ne=y=>(-X.z-X.x*y)/X.y,ie=h.exports.useRef(),Z={root:ie.current,rootMargin:"0px",threshold:1},[xe,m]=ve(Z),[qe,Ie]=ve(Z),[ze,Ee]=ve(Z),[ue,be]=h.exports.useState(!1),[ae,pe]=h.exports.useState({c1PointPrediction:!1,c2PointPrediction:!1,c1Frustum:!1,c2Frustum:!1,epipolarLines:!1,epipolarLinePredictions:!1}),[He,ke]=h.exports.useState($.nothing),[je,I]=h.exports.useState(l.nothing),[Ve,z]=h.exports.useState(l.nothing);return i("div",{className:"App",children:[e(Lt,{x:c,xp:j,lFunction:he,lpFunction:ne,setX:n,isMoving:ue,setK:o,setM:r,setC1Pos:M,showC1Display:m,setKp:k,setMp:C,setC2Pos:f,showC2Display:Ie,showC3Display:Ee,otherThingsToShow:ae,sceneCommand:He,setSceneCommand:ke,c1Command:je,setC1Command:I,c2Command:Ve,setC2Command:z}),e("div",{id:"scroll-outer",children:e("div",{ref:ie,children:i("div",{id:"scroll-inner",children:[e("h1",{className:"title-text",children:"CSCI 1430: Fundamental Matrix Workshop"}),i("div",{className:"body-text",children:[i("p",{children:["Hello! In this workshop, we'll walk through how to go from ",e("strong",{children:"camera matrices"})," to the ",e("strong",{children:"fundamental matrix"})," and ",e("strong",{children:"epipolar lines"}),"."]}),i("p",{children:["Epipolar geometry is a challenging concept to nail down, ","so if you have any questions, please make sure to ask us TAs!"]})]}),e("h2",{id:"camera-matrices-recap",className:"title-text",children:"Camera Matrices (Recap)"}),e("div",{className:"body-text",children:i("p",{children:["In previous lectures, you learned that a pinhole camera can be described by its ",e("strong",{children:"projection"})," matrix, which is the product of its ",e("strong",{children:"intrinsic"})," and ",e("strong",{children:"extrinsic"})," matrices:"]})}),i(A,{children:[e(S,{label:"projection matrix",matrix:qt}),e("span",{className:"big",children:"="}),e(w,{label:"intrinsic matrix",matrix:It}),e("span",{children:"*"}),e(S,{label:"extrinsic matrix",matrix:zt})]}),i("div",{className:"body-text",children:[i("p",{children:["Recall that the ",e("strong",{children:e("em",{children:"intrinsic"})})," matrix depends only on things ",e("em",{children:"intrinsic"})," to the camera, like its field of view."]}),i("p",{children:["Likewise, the ",e("strong",{children:e("em",{children:"extrinsic"})})," matrix depends only on the camera's ",e("em",{children:"extrinsic"})," properties: its rotation and position in space."]})]}),e("div",{className:"body-text",children:i("blockquote",{children:[i("p",{children:["Think:  ","using only the extrinsic matrix, can you determine the camera's ","position in world space? If yes, how?"]}),i("p",{children:["Hint:  ","it's not <tx, ty, tz>."]})]})}),e("h2",{id:"introducing-camera-1",className:"title-text",children:"Introducing: Camera 1"}),e("div",{className:"body-text",children:i("p",{children:["Now, let's look at an ",e("strong",{children:"interactive example"}),". Here, we've set up a scene with an object and a camera (we'll call this ",e("strong",{children:"camera 1"}),")."]})}),i(A,{ref:xe,children:[e("span",{children:"Camera 1 has"}),e(w,{label:"intrinsic matrix, K",matrix:a}),e("span",{children:", "}),e(S,{label:"extrinsic matrix, M",matrix:s}),e("span",{children:", and"}),e(P,{label:"position",vector:d})]}),i("div",{className:"body-text",children:[i("p",{children:["Move the camera, and see how its intrinsic and extrinsic matrices change. ","You can drag with one finger to rotate, drag with two fingers to pan, ","scroll to zoom, or click any of these buttons:"]}),i("p",{children:[e("button",{className:"control-button",onClick:()=>I(l.setRotationToIdentity),children:"Set Rotation To Identity"})," ",e("button",{className:"control-button",onClick:()=>I(l.setLookPositionToOrigin),children:"Look At Origin"})," ",e("button",{className:"control-button",onClick:()=>I(l.resetTransforms),children:"Reset"})]}),i("p",{children:["Standard views: ",e("button",{className:"control-button",onClick:()=>I(l.useStandardViewX),children:"X Axis"})," ",e("button",{className:"control-button",onClick:()=>I(l.useStandardViewY),children:"Y Axis"})," ",e("button",{className:"control-button",onClick:()=>I(l.useStandardViewZ),children:"Z Axis"})]})]}),e("div",{className:"body-text",children:e("blockquote",{children:i("p",{children:["Notice how the right-most column of M changes when you rotate the camera, ","even if you don't change its position."]})})}),e("h2",{id:"projection-recap",className:"title-text",children:"Projection (Recap)"}),i("div",{className:"body-text",children:[i("p",{children:["If you've done the written component of HW3, you'd already have ",e("strong",{children:"projected"})," points in world space onto an image plane. ","If not, that's okay! We'll briefly recap the basic principles here :)"]}),i("p",{children:["Using camera 1 as an example, let's project the point located at ",e("strong",{children:`<${E(t.x)},\xA0${E(t.y)},\xA0${E(t.z)}>`})," onto our image plane."]})]}),i(A,{children:[e(w,{label:"intrinsic matrix, K",matrix:a}),e("span",{children:"*"}),e(S,{label:"extrinsic matrix, M",matrix:s}),e("span",{children:"*"}),e(B,{label:"world coord, X",vector:t}),e("span",{className:"big",children:"="}),e(P,{label:"result",vector:L}),e("span",{className:"big",children:"="}),e("span",{className:"limit-dp",children:E(L.z)}),e(P,{label:"image coord, x",vector:c,className:"blue"})]}),i("div",{className:"body-text",children:[i("p",{children:["This equation may seem scary, but it's lot simpler when you recall the steps for projection: ",e("br",{}),"1. Multiply K * M * X to get a 3x1 result",e("br",{}),"2. Then, divide that result by its z component",e("br",{}),"3. Finally, the result's ",e("strong",{className:"blue",children:"x and y values"})," give the point's normalized* coordinates on the image plane."]}),i("p",{children:["Now that we've calculated where the point should be, let's see if our prediction is correct. ","Click the button below to show a ",e("strong",{className:"blue",children:"marker"})," on the image: "]}),e("p",{children:e("button",{className:"control-button",onClick:()=>pe(y=>re(oe({},y),{c1PointPrediction:!y.c1PointPrediction})),children:ae.c1PointPrediction?"Hide Camera 1's Point Prediction":"Show Camera 1's Point Prediction"})})]}),i("div",{className:"body-text",children:[i("p",{children:["Try moving the camera around again! Or, click the button below to make the point ",ue?"stop moving":"start moving",":"]}),e("p",{children:e("button",{className:"control-button",onClick:()=>be(y=>!y),children:ue?"Stop Moving":"Start Moving"})})]}),e("div",{className:"body-text",children:i("blockquote",{children:[i("p",{children:["Think:  ","why are x and y axes flipped, resulting in <1,\xA01> being at the bottom left?"]}),i("p",{children:["Hint 1:  ","in our ",e("em",{children:"result"}),", z is +1. If the camera looks in the \u2011z direction, ","where is the image plane relative to the camera center?"]}),i("p",{children:["Hint 2:  ",'have you ever been told that the images on your retinas (in your eyes) are "inverted"? ','Remember when you had to "invert" kernels for convolution? ']})]})}),e("h2",{id:"introducing-camera-2",className:"title-text",children:"Introducing: Camera 2"}),e("div",{className:"body-text",children:i("p",{children:["Now that we're through the recaps, it's finally time to talk about ",e("strong",{children:"stereo camera pairs"}),". For that, let's introduce ",e("strong",{children:"camera 2"}),"!"]})}),i(A,{ref:qe,children:[e("span",{children:"Camera 2 has"}),e(w,{label:"intrinsic matrix, Kp",matrix:u}),e("span",{children:", "}),e(S,{label:"extrinsic matrix, Mp",matrix:b}),e("span",{children:", and"}),e(P,{label:"position",vector:v})]}),e("div",{className:"body-text",children:i("p",{children:["Just like we did with camera 1, we can project the point located at ",e("strong",{children:`<${E(t.x)},\xA0${E(t.y)},\xA0${E(t.z)}>`})," onto camera 2's image plane:"]})}),i(A,{children:[e(w,{label:"intrinsic matrix, K'",matrix:u}),e("span",{children:"*"}),e(S,{label:"extrinsic matrix, M'",matrix:b}),e("span",{children:"*"}),e(B,{label:"world coord, X",vector:t}),e("span",{className:"big",children:"="}),e(P,{label:"result",vector:q}),e("span",{className:"big",children:"="}),e("span",{className:"limit-dp",children:E(q.z)}),e(P,{label:"image coord, x'",vector:j,className:"green"})]}),i("div",{className:"body-text",children:[e("p",{children:e("button",{className:"control-button",onClick:()=>pe(y=>re(oe({},y),{c2PointPrediction:!y.c2PointPrediction})),children:ae.c2PointPrediction?"Hide Camera 2's Point Prediction":"Show Camera 2's Point Prediction"})}),e("p",{children:"And, of course, we can also move camera 2 around:"})]}),i("div",{className:"body-text",children:[i("p",{children:[e("button",{className:"control-button",onClick:()=>z(l.setRotationToIdentity),children:"Set Rotation To Identity"})," ",e("button",{className:"control-button",onClick:()=>z(l.setLookPositionToOrigin),children:"Look At Origin"})," ",e("button",{className:"control-button",onClick:()=>z(l.resetTransforms),children:"Reset"})]}),i("p",{children:["Standard views: ",e("button",{className:"control-button",onClick:()=>z(l.useStandardViewX),children:"X Axis"})," ",e("button",{className:"control-button",onClick:()=>z(l.useStandardViewY),children:"Y Axis"})," ",e("button",{className:"control-button",onClick:()=>z(l.useStandardViewZ),children:"Z Axis"})]})]}),e("h2",{id:"stereo-camera-pair",className:"title-text",children:"Getting To Know Our Stereo Camera Pair"}),i("div",{className:"body-text",children:[i("p",{ref:ze,children:["Surprise! Here's yet ",e("em",{children:"another"})," camera. "]}),i("p",{children:["This one's just for reference (we'll call it the ",e("strong",{children:"witness"}),"), so we won't be using it in any calculations or anything."]}),e("p",{children:"Let's use it to take a look at what our cameras can see:"}),i("p",{children:[e("button",{className:"control-button",onClick:()=>pe(y=>re(oe({},y),{c1Frustum:!y.c1Frustum})),children:ae.c1Frustum?"Hide Camera 1's Frustum":"Show Camera 1's Frustum"})," ",e("button",{className:"control-button",onClick:()=>pe(y=>re(oe({},y),{c2Frustum:!y.c2Frustum})),children:ae.c2Frustum?"Hide Camera 2's Frustum":"Show Camera 2's Frustum"})]}),i("p",{children:["(You don't have to know this for CV, but a camera's ",e("strong",{children:"frustum"})," is the shape which contains the region of space the camera can see)"]})]}),e("h2",{id:"camera-to-camera-transforms-prelude",className:"title-text",children:"Camera-to-Camera Transforms (Prelude)"}),e("div",{className:"body-text",children:i("blockquote",{children:[i("p",{children:["Think:  ","we've seen that can map a 3D world coordinate to a 2D point on either camera; ","but is it possible to map a 2D point on one camera to a 2D point on another? ","Why or why not? "]}),i("p",{children:["Hint:  ","is a 3D-to-2D mapping reversible?"]})]})}),i("div",{className:"body-text",children:[i("p",{children:["Since ",e("strong",{children:"epipolar geometry"})," is all about the relationship between two cameras,"," we typically begin by finding the ",e("strong",{children:"relative transformation"})," from c1's space to c2's space."]}),i("p",{children:[e("em",{children:e("strong",{children:"But wait:"})}),` what does a camera's "space" even mean, anyway? `]})]}),e("h2",{id:"camera-spaces",className:"title-text",children:"Camera Spaces"}),i("div",{className:"body-text",children:[i("p",{children:["Recall that ",e("a",{href:"#projection-recap",children:"when we talked about 2D image coordinates"}),", we used ",e("strong",{className:"blue",children:"x and y"}),`, and fixed z\xA0=\xA01, which just meant "it's on the image plane". `,e("em",{children:"But who's to say we can't have coordinates where z\xA0\u2260\xA01?"})]}),i("p",{children:["Here's c1's projection equation again, but only its first step (M\xA0*\xA0X). ","Here are also some controls for the point:"]}),i("p",{children:[e("button",{className:"control-button",onClick:()=>{be(!1),ke($.setPointToOrigin)},children:"Set Point To Origin"})," ",e("button",{className:"control-button",onClick:()=>be(y=>!y),children:ue?"Stop Moving":"Start Moving"})]})]}),i(A,{children:[e(w,{label:"intrinsic matrix, K",matrix:a}),e("span",{children:"*"}),e(S,{label:"extrinsic matrix, M",matrix:s,className:"blue last"}),e("span",{children:"*"}),e(B,{label:"world coord, X",vector:t}),e("span",{className:"big",children:"="}),e(w,{label:"intrinsic matrix, K",matrix:a}),e("span",{children:"*"}),e(P,{label:"M * X",vector:x,className:"blue all"})]}),e("div",{className:"body-text",children:i("blockquote",{children:[i("p",{children:["Think:  ","what does the right-most column of the extrinsic matrix (M) represent, ",`in terms of the camera's "space"?`]}),i("p",{children:["Hint:  ","did you try setting the point to the ",e("em",{children:"origin"}),"?"]})]})}),i("div",{className:"body-text",children:[i("p",{children:[`For the first time, we're going to give you an answer to a "think" question: `,"the right-most column represents the ",e("strong",{children:"world-space origin"})," in ",e("strong",{children:"camera space"}),"."]}),i("p",{children:["In fact, that's the whole point of the ",e("strong",{children:"extrinsic matrix"}),"! It takes ",e("em",{children:"any"})," point in world space and maps it to a corresponding point ",e("strong",{children:"in camera space"}),"."]})]}),e("div",{className:"body-text",children:i("blockquote",{children:[i("p",{children:["By the way, since an extrinsic matrix is just a rotation and a translation, it is ",e("em",{children:e("strong",{children:"invertible"})}),"."]}),i("p",{children:["However, this doesn't mean that ",e("em",{children:e("strong",{children:"projection"})})," is invertible! Recall that you divide ","by z, and then toss that value away. That information is gone, so z could have been anything"]}),i("p",{children:["Think:  ","if you fix just 2 of 3 dimensions, what kind of shape do you get?"]})]})}),e("div",{className:"body-text",children:i("p",{children:["This was all you need to know about coordinate spaces for CV. ","We're now ready to talk about ",e("strong",{children:"camera-to-camera transforms"}),"."]})}),e("h2",{id:"camera-to-camera-transforms",className:"title-text",children:"Camera-to-Camera Transforms"}),e("div",{className:"body-text",children:i("p",{children:["As we just discussed, a world-space coordinate X can be mapped to a ","camera-space coordinate by left-multiplying it by M:"]})}),i(A,{initialCollapse:!0,children:[e(S,{label:"M",matrix:s,className:"blue last"}),e("span",{children:"*"}),e(B,{label:"X",vector:t}),e("span",{className:"big",children:"="}),e(P,{label:"camera 1 space coord",vector:x,className:"blue all"})]}),e("div",{className:"body-text",children:i("p",{children:["We want to rearrange this so that X is on the left-hand side. ","To do this, we will pretend that M is a ",e("strong",{children:"square matrix"})," with [0,\xA00,\xA00,\xA01] on the bottom row, so that we can take its ",e("em",{children:e("strong",{children:"inverse"})}),"."]})}),i(A,{initialCollapse:!0,children:[e(S,{label:"M (3 x 4)",matrix:s}),e("span",{className:"big",children:"\u2192"}),e(G,{label:"M (4 x 4)",matrix:s}),e("span",{className:"big",children:"\u2192"}),e(G,{label:"inverse of extrinsic matrix, M\u207B\xB9",matrix:F})]}),e("div",{className:"body-text",children:i("p",{children:["We'll also have to ",e("strong",{children:"homogenize"})," the camera space coordinate, by sticking a 1 on the bottom. ","Then, we can rearrange the earlier equation:"]})}),i(A,{initialCollapse:!0,children:[e(B,{label:"X",vector:t}),e("span",{className:"big",children:"="}),e(G,{label:"M\u207B\xB9",matrix:F}),e("span",{children:"*"}),e(B,{label:"camera 1 space coord",vector:x,className:"blue all"})]}),e("div",{className:"body-text",children:i("p",{children:["Now, if we want to get to ",e("strong",{children:"camera 2's"})," space, we can just left-multiply by ",i("strong",{children:[e("em",{children:"its"})," extrinsic matrix, M'"]}),"! (Note that we have to do the same trick to make M' 4\xA0x\xA04):"]})}),i(A,{initialCollapse:!0,children:[e(B,{label:"camera 2 space coord",vector:N,className:"green all"}),e("span",{className:"big",children:"="}),e(G,{label:"M'",matrix:b}),e("span",{children:"*"}),e(G,{label:"M\u207B\xB9",matrix:F}),e("span",{children:"*"}),e(B,{label:"camera 1 space coord",vector:x,className:"blue all"})]}),e("div",{className:"body-text",children:e("p",{children:"Finally, to make our lives easier, we can combine M' * M\u207B\xB9 into a single matrix:"})}),i(A,{children:[e(S,{label:"M'",matrix:b}),e("span",{children:"*"}),e(S,{label:"M\u207B\xB9",matrix:F}),e("span",{className:"big",children:"="}),e(G,{label:"camera 1 space to camera 2 space",matrix:T})]}),i("div",{className:"body-text",children:[i("p",{children:["As always, you're ",e("em",{children:"highly"})," encouraged to mess around with the positions of c1 and c2",", and see how the above matrix changes!"]}),i("p",{children:[e("button",{className:"control-button",onClick:()=>I(l.setRotationToMatchC2),children:"Rotate c1 to match c2"})," ",e("button",{className:"control-button",onClick:()=>I(l.setPositionToMatchC2),children:"Translate c1 to match c2"})," ",e("button",{className:"control-button",onClick:()=>I(l.resetTransforms),children:"Reset c1"})]}),i("p",{children:[e("button",{className:"control-button",onClick:()=>z(l.setRotationToMatchC1),children:"Rotate c2 to match c1"})," ",e("button",{className:"control-button",onClick:()=>z(l.setPositionToMatchC1),children:"Translate c2 to match c1"})," ",e("button",{className:"control-button",onClick:()=>z(l.resetTransforms),children:"Reset c2"})]})]}),e("h2",{id:"relative-rotation-and-translation",className:"title-text",children:"Relative Rotation And Translation"}),e("div",{className:"body-text",children:i("p",{children:["Next, let's break the above matrix apart. We define these parts as "," weird math expressions, but it will make more sense later!"]})}),i(A,{children:[e("span",{children:" break "}),e(G,{label:"camera 1 space to camera 2 space",matrix:T}),e("span",{children:" into "}),e(w,{label:"left side, defined as R\u1D40",matrix:D}),e("span",{children:" and "}),e(P,{label:"right side, defined as -(R\u1D40 * T)",vector:V})]}),i("div",{className:"matrix-equation",children:[e("span",{children:"From R\u1D40 and -(R\u1D40 * T), we can then get "}),e(w,{label:"R",matrix:D}),e("span",{children:" and "}),e(P,{label:"T",vector:Y})]}),i("div",{className:"body-text",children:[i("p",{children:["Think:  ","what exactly do ",e("strong",{children:"R"})," and ",e("strong",{children:"T"})," represent, and what's up with the -(R\u1D40 * T) on the right side?"]}),e("p",{children:e("strong",{children:"Explanation (click to expand):"})}),i("p",{children:["Imagine both cameras shared the same world position, but differed in rotation. Then, ","R\u1D40 would take camera 1's (c1's) direction and rotate it to match camera 2's (c2's). ","Thus, R\u1D40 is ",e("strong",{children:"the rotation from c1 to c2"}),", and since transposition is the same as inversion for rotation matrices, R is ",e("strong",{children:"the rotation from c2 to c1"}),"."]}),i("p",{children:["Now, imagine they have different world positions as well. ","R\u1D40 again rotates c1 to be parallel to c2. ","But now, to move c1 to perfectly match c2, ","we need to translate it by some vector ",e("em",{children:"in c2's space"}),": this is -(R\u1D40 * T), ",e("strong",{children:"the translation from c1 to c2, in c2's space"}),"."]}),i("p",{children:["On the flip side, T is ",e("strong",{children:"the translation from c2 to c1, in c1's space"}),"."]})]}),i("div",{className:"body-text",children:[i("p",{children:[e("strong",{children:"Whew!"})," That was a lot to get through!"]}),i("p",{children:["Don't worry, it took me >20h to figure this out, ","and you don't have to totally understand this for HW3."]}),i("p",{children:["But now, ",e("strong",{children:"given R and T"}),", we can finally make the ",e("strong",{children:"essential matrix"}),"! Just follow the recipe:"]})]}),i("div",{className:"matrix-equation",children:[e("span",{children:"First, convert T into its cross-product matrix form: "}),e(P,{label:"T",vector:Y}),e("span",{children:"=>"}),e(w,{label:"T_x",matrix:_})]}),i("div",{className:"matrix-equation",children:[e("span",{children:"Then multiply!: "}),e(w,{label:"T_x",matrix:_}),e("span",{children:"*"}),e(w,{label:"R",matrix:D}),e("span",{className:"big",children:"="}),e(w,{label:"E",matrix:U})]}),e("div",{className:"body-text",children:i("p",{children:["The essential matrix is great for ",e("strong",{children:"canonical cameras"}),", with K = identity, but we have non-canonical cameras here. So, we must instead get the ",e("strong",{children:"fundamental matrix"}),":"]})}),i("div",{className:"matrix-equation",children:[e(w,{label:"K\u207B\u1D40",matrix:ee}),e("span",{children:"*"}),e(w,{label:"E",matrix:U}),e("span",{children:"*"}),e(w,{label:"K'\u207B\xB9",matrix:te}),e("span",{className:"big",children:"="}),e(w,{label:"F",matrix:O})]}),e("div",{className:"body-text",children:i("p",{children:["And with that, we can finally make ",e("strong",{children:"epipolar lines"}),"! ","Those are what I'm using to position the circles on the sides of the images above."]})}),i("div",{className:"matrix-equation",children:[e(w,{label:"F",matrix:O}),e("span",{children:"*"}),e(P,{label:"x'",vector:j,className:"green"}),e("span",{className:"big",children:"="}),e(P,{label:"l",vector:W,className:"green all"})]}),i("div",{className:"matrix-equation",children:[e(w,{label:"F\u1D40",matrix:R}),e("span",{children:"*"}),e(P,{label:"x",vector:c,className:"blue"}),e("span",{className:"big",children:"="}),e(P,{label:"l'",vector:X,className:"blue all"})]}),i("div",{className:"body-text",children:[i("p",{children:[e("strong",{children:"Congratulations!"}),e("br",{}),"You made it through the most difficult concept in CSCI 1430 :)"]}),i("p",{children:["As you saw above, we used ",e("strong",{children:"known camera matrices"})," to get a fundamental matrix. This is just ",e("strong",{children:"one"})," way to do it, and probably the harder one."]}),i("p",{children:["In HW3, you will implement a different way, one which involves ","using point correspondences to ",e("em",{children:"guess"})," the fundamental matrix, instead. All the best!"]})]})]})})})]})}st.render(e(K.StrictMode,{children:e(Et,{})}),document.getElementById("root"));
