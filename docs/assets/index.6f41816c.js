import{j as Z,S as ne,a as re,I as ie,M as se,b as le,P as ce,V as F,L as oe,B as de,c as me,C as pe,W as he,O as ue,A as xe,G as fe,r as p,d as ee,e as $,f as j,R as ye,g as ve}from"./vendor.92ce5990.js";const ge=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function c(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=c(r);fetch(r.href,s)}};ge();const L=7;function A(n){if(Math.abs(n)<1e-4)return"0";const t=n.toString();return t.length>L?t.slice(0,L-1)+"\u2026":t.slice(0,L)}const e=Z.exports.jsx,a=Z.exports.jsxs;function g({label:n,matrix:t}){return a("div",{className:"matrix",children:[e("div",{className:"matrix-label",children:n}),e("div",{className:"matrix-elements",style:{gridTemplate:"repeat(4, 1fr) / repeat(4, auto)"},children:t.elements.map((c,i)=>e("span",{className:"limit-dp",children:A(c)},i))})]})}function P({label:n,vector:t,className:c}){return a("div",{className:"matrix "+c,children:[e("div",{className:"matrix-label",children:n}),e("div",{className:"matrix-elements",style:{gridTemplate:"repeat(4, 1fr) / auto"},children:t.toArray().map((i,r)=>e("span",{className:"limit-dp",children:A(i)},r))})]})}const C=new ne;C.showPanel(0);document.body.appendChild(C.dom);C.dom.style.zIndex="100000000000000";function te(n,t){t.nextFrameReq=requestAnimationFrame(c=>te(c,t)),C.begin(),t.isPlaying&&(be(n,t),we(n,t),t.updateGUIFunction(t)),C.end()}function be(n,t){t.prevTime=n,t.pointPosition.y=2+Math.sin(n*.0015)*2}function we(n,t){for(let c=0;c<t.cameraData.length;c++){const i=t.cameraData[c],r=i.renderer,s=i.camera,m=i.container.clientWidth,h=i.container.clientHeight;s.aspect=m/h,s.updateProjectionMatrix(),r.setSize(m,h),i.orbitControls.update();const l=i.line.geometry.attributes.position.array,u=t.pointPosition.clone().sub(i.camera.position),x=i.camera.position.clone().add(u.clone().multiplyScalar(-1e3)),b=i.camera.position.clone().add(u.clone().multiplyScalar(1e3));l[0]=x.x,l[1]=x.y,l[2]=x.z,l[3]=b.x,l[4]=b.y,l[5]=b.z,i.line.geometry.attributes.position.needsUpdate=!0,r.render(t.scene,i.camera)}}function Ne(n){const t=new re,c=new ie(.25),i=new se({color:15257272}),r=new le(c,i);r.layers.enableAll(),t.add(r);const s=[];for(let l=0;l<n.length;l++){const u=n[l].container.clientWidth,x=n[l].container.clientHeight,b=u/x,o=new ce(30,b,1e-4,1e4);l?o.position.set(10,10,10+l*5):o.position.set(35,20,20),o.lookAt(new F),o.layers.set(l);const f=new oe({color:l?6010245:33511}),q=[o.position,r.position],S=new de().setFromPoints(q),w=new me(S,f);w.frustumCulled=!1,w.layers.enableAll(),w.layers.disable(l),t.add(w);const y=new pe(o);y.layers.enableAll(),y.layers.disable(l),t.add(y);const R=new he({canvas:n[l].canvas});R.setPixelRatio(window.devicePixelRatio),R.setClearColor(1315346),R.setSize(u,x);const k=new ue(o,n[l].container);s.push({camera:o,line:w,renderer:R,container:n[l].container,canvas:n[l].canvas,orbitControls:k,extrinsicMatrix:o.matrixWorldInverse,intrinsicMatrix:o.projectionMatrix})}const m=new xe(10);m.layers.enableAll(),t.add(m);const h=new fe(5,5,16711680,8680812);return h.layers.enableAll(),t.add(h),{isPlaying:!0,scene:t,pointPosition:r.position,updateGUIFunction:l=>{},nextFrameReq:0,prevTime:0,cameraData:s}}function Me(n,t,c,i){const r=Ne([{container:n,canvas:t},{container:c,canvas:i}]);return r.nextFrameReq=requestAnimationFrame(s=>te(s,r)),r}function d({label:n,matrix:t}){return a("div",{className:"matrix",children:[e("div",{className:"matrix-label",children:n}),e("div",{className:"matrix-elements",style:{gridTemplate:"repeat(3, 1fr) / repeat(3, auto)"},children:t.elements.map((c,i)=>e("span",{className:"limit-dp",children:A(c)},i))})]})}function M({label:n,vector:t,className:c}){return a("div",{className:"matrix "+c,children:[e("div",{className:"matrix-label",children:n}),e("div",{className:"matrix-elements",style:{gridTemplate:"repeat(3, 1fr) / auto"},children:t.toArray().map((i,r)=>e("span",{className:"limit-dp",children:A(i)},r))})]})}function Re(n){return new j().fromArray([0,-n.z,n.y,n.z,0,-n.x,-n.y,n.x,0])}function Te(){const n=p.exports.useRef(),t=p.exports.useRef(),c=p.exports.useRef(),i=p.exports.useRef(),r=p.exports.useRef(),[s,m]=p.exports.useState(new ee),[h,l]=p.exports.useState(new $),[u,x]=p.exports.useState(new $),b=h.clone().multiply(u),o=s.clone().applyMatrix4(b),f=o.clone().divideScalar(o.z),q=new F(f.x,f.y,f.z),[S,w]=p.exports.useState(new $),[y,R]=p.exports.useState(new $),k=S.clone().multiply(y),B=s.clone().applyMatrix4(k),T=B.clone().divideScalar(B.z),E=new F(T.x,T.y,T.z),O=u.clone().invert(),I=y.clone().multiply(O),ae=new j().setFromMatrix4(I),U=new F().setFromMatrixColumn(I,3),z=ae.clone().transpose(),H=U.clone().multiplyScalar(-1).applyMatrix3(z),W=Re(H),V=new j().setFromMatrix4(h).invert().transpose(),X=new j().setFromMatrix4(S).invert(),G=W.clone().multiply(z),K=V.clone().multiply(G).multiply(X),_=K.clone().transpose(),v=E.clone().applyMatrix3(K),J=new F((v.x-v.z)/v.y,0,(-v.x-v.z)/v.y),D=q.clone().applyMatrix3(_),Y=new F((D.x-D.z)/D.y,0,(-D.x-D.z)/D.y);return p.exports.useEffect(()=>{n.current=Me(t.current,c.current,i.current,r.current);function Q(N){l(N.cameraData[0].intrinsicMatrix),x(N.cameraData[0].extrinsicMatrix),w(N.cameraData[1].intrinsicMatrix),R(N.cameraData[1].extrinsicMatrix),m(new ee(N.pointPosition.x,N.pointPosition.y,N.pointPosition.z,1))}Q(n.current),n.current.updateGUIFunction=Q},[]),a("div",{className:"App",children:[a("div",{id:"container-container",children:[a("div",{className:"container",ref:t,children:[e("canvas",{className:"canvas",ref:c}),e("div",{className:"target blue",style:{transform:`translate(${f.x*50}%, ${-f.y*50}%) scale(0.02)`}}),e("div",{className:"target green",style:{transform:`translate(${-50}%, ${-J.x*50||0}%) scale(0.02)`}}),e("div",{className:"target green",style:{transform:`translate(${50}%, ${-J.z*50||0}%) scale(0.02)`}})]}),a("div",{className:"container",ref:i,children:[e("canvas",{className:"canvas",ref:r}),e("div",{className:"target green",style:{transform:`translate(${T.x*50}%, ${-T.y*50}%) scale(0.02)`}}),e("div",{className:"target blue",style:{transform:`translate(${-50}%, ${-Y.x*50||0}%) scale(0.02)`}}),e("div",{className:"target blue",style:{transform:`translate(${50}%, ${-Y.z*50||0}%) scale(0.02)`}})]})]}),e("div",{id:"scroll-outer",children:a("div",{id:"scroll-inner",children:[a("div",{className:"text",children:[a("p",{children:["Welcome! Get comfy, because this page is all about how to mathematically go from ",e("strong",{children:"camera matrices"})," to the ",e("strong",{children:"fundamental matrix"})," and ",e("strong",{children:"epipolar lines"}),"."]}),a("p",{children:["Let's get started with some simple camera projection, based on the cameras and objects ","in the scene simulated above."]}),a("p",{children:["By the way, any time you see a ",e("strong",{style:{color:"#5bb585"},children:"colored "}),e("strong",{style:{color:"#0082e7"},children:"circle "}),"up there, that's actually our prediction (using CSS), not a part of the simulation!"]})]}),a("div",{className:"matrix-equation",children:[e(g,{label:"intrinsic matrix, K",matrix:h}),e("span",{children:"*"}),e(g,{label:"extrinsic matrix, M",matrix:u}),e("span",{children:"*"}),e(P,{label:"world coord, X",vector:s}),e("span",{children:"="}),e(P,{label:"result",vector:o}),e("span",{children:"="}),e("span",{className:"limit-dp",children:A(o.z)}),e(P,{label:"image coord, x",vector:f,className:"blue"})]}),a("div",{className:"matrix-equation",children:[e(g,{label:"intrinsic matrix, K'",matrix:S}),e("span",{children:"*"}),e(g,{label:"extrinsic matrix, M'",matrix:y}),e("span",{children:"*"}),e(P,{label:"world coord, X",vector:s}),e("span",{children:"="}),e(P,{label:"result",vector:B}),e("span",{children:"="}),e("span",{className:"limit-dp",children:A(B.z)}),e(P,{label:"image coord, x'",vector:T,className:"green"})]}),a("div",{className:"text",children:[a("p",{children:["Since ",e("strong",{children:"epipolar geometry"})," is all about the relationship between two cameras,"," let's begin by finding the ",e("strong",{children:"relative transformation"})," from camera 1's space to camera 2's space."]}),a("p",{children:["If we have a coordinate in camera 1's space, first we ",e("strong",{children:"left-multiply by M\u207B\xB9"})," to get to world space. Then, we ",e("strong",{children:"left-multiply by M'"})," to get to camera 2's space. This can be combined as below:"]})]}),a("div",{className:"matrix-equation",children:[e(g,{label:"M'",matrix:y}),e("span",{children:"*"}),e(g,{label:"M\u207B\xB9",matrix:O}),e("span",{children:"="}),e(g,{label:"camera 1 space to camera 2 space",matrix:I})]}),e("div",{className:"text",children:a("p",{children:["Next, let's break the above matrix apart. We define these parts as "," weird math expressions, but it will make more sense later!"]})}),a("div",{className:"matrix-equation",children:[e("span",{children:" break "}),e(g,{label:"camera 1 space to camera 2 space",matrix:I}),e("span",{children:" into "}),e(d,{label:"left side, defined as R\u1D40",matrix:z}),e("span",{children:" and "}),e(M,{label:"right side, defined as -(R\u1D40 * T)",vector:U})]}),a("div",{className:"matrix-equation",children:[e("span",{children:"From R\u1D40 and -(R\u1D40 * T), we can then get "}),e(d,{label:"R",matrix:z}),e("span",{children:" and "}),e(M,{label:"T",vector:H})]}),a("div",{className:"text",children:[a("p",{children:[e("strong",{children:"Think:"})," What exactly do ",e("strong",{children:"R"})," and ",e("strong",{children:"T"})," represent, and what's up with the -(R\u1D40 * T) on the right side?"]}),e("p",{children:e("strong",{children:"Explanation (click to expand):"})}),a("p",{children:["Imagine both cameras shared the same world position, but differed in rotation. Then, ","R\u1D40 would take camera 1's (c1's) direction and rotate it to match camera 2's (c2's). ","Thus, R\u1D40 is ",e("strong",{children:"the rotation from c1 to c2"}),", and since transposition is the same as inversion for rotation matrices, R is ",e("strong",{children:"the rotation from c2 to c1"}),"."]}),a("p",{children:["Now, imagine they have different world positions as well. ","R\u1D40 again rotates c1 to be parallel to c2. ","But now, to move c1 to perfectly match c2, ","we need to translate it by some vector ",e("em",{children:"in c2's space"}),": this is -(R\u1D40 * T), ",e("strong",{children:"the translation from c1 to c2, in c2's space"}),"."]}),a("p",{children:["On the flip side, T is ",e("strong",{children:"the translation from c2 to c1, in c1's space"}),"."]})]}),e("div",{className:"matrix-equation",children:e("span",{style:{top:0},children:"(\u0CA5\uFE4F\u0CA5)"})}),a("div",{className:"text",children:[a("p",{children:[e("strong",{children:"Whew!"})," That was a lot to get through!",e("br",{}),"Don't worry, it took me >20h to figure this out, ","and you don't have to totally understand this for HW3."]}),a("p",{children:["But now, ",e("strong",{children:"given R and T"}),", we can finally make the ",e("strong",{children:"essential matrix"}),"! Just follow the recipe:"]})]}),a("div",{className:"matrix-equation",children:[e("span",{children:"First, convert T into its cross-product matrix form: "}),e(M,{label:"T",vector:H}),e("span",{children:"=>"}),e(d,{label:"T_x",matrix:W})]}),a("div",{className:"matrix-equation",children:[e("span",{children:"Then multiply!: "}),e(d,{label:"T_x",matrix:W}),e("span",{children:"*"}),e(d,{label:"R",matrix:z}),e("span",{children:"="}),e(d,{label:"E",matrix:G})]}),e("div",{className:"text",children:a("p",{children:["The essential matrix is great for ",e("strong",{children:"canonical cameras"}),", with K = identity, but we have non-canonical cameras here. So, we must instead get the ",e("strong",{children:"fundamental matrix"}),":"]})}),a("div",{className:"matrix-equation",children:[e(d,{label:"K\u207B\u1D40",matrix:V}),e("span",{children:"*"}),e(d,{label:"E",matrix:G}),e("span",{children:"*"}),e(d,{label:"K'\u207B\xB9",matrix:X}),e("span",{children:"="}),e(d,{label:"F",matrix:K})]}),e("div",{className:"text",children:a("p",{children:["And with that, we can finally make ",e("strong",{children:"epipolar lines"}),"! ","Those are what I'm using to position the circles on the sides of the images above."]})}),a("div",{className:"matrix-equation",children:[e(d,{label:"F",matrix:K}),e("span",{children:"*"}),e(M,{label:"x'",vector:E,className:"green"}),e("span",{children:"="}),e(M,{label:"l",vector:v,className:"blue all"})]}),a("div",{className:"matrix-equation",children:[e(d,{label:"F\u1D40",matrix:_}),e("span",{children:"*"}),e(M,{label:"x",vector:q,className:"blue"}),e("span",{children:"="}),e(M,{label:"l'",vector:v,className:"green all"})]}),a("div",{className:"text",children:[a("p",{children:[e("strong",{children:"Congratulations!"}),e("br",{}),"You made it through the most difficult concept in CSCI 1430 :)"]}),a("p",{children:["As you saw above, we used ",e("strong",{children:"known camera matrices"})," to get a fundamental matrix. This is just ",e("strong",{children:"one"})," way to do it, and probably the harder one."]}),a("p",{children:["In HW3, you will implement a different way, one which involves ","using point correspondences to ",e("em",{children:"guess"})," the fundamental matrix, instead. All the best!"]})]})]})})]})}ye.render(e(ve.StrictMode,{children:e(Te,{})}),document.getElementById("root"));
